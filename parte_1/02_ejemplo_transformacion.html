<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geoinformática - 2&nbsp; Limpieza y transformación de datos de COVID-19 en México</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../parte_1/03_automatizacion_transformacion.html" rel="next">
<link href="../parte_1/01_transformacion.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Limpieza y transformación de datos de COVID-19 en México</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Geoinformática</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Prefacio</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">Introducción</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../parte_1.html" class="sidebar-item-text sidebar-link">Geoinformática: las herramientas básicas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parte_1/01_transformacion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Transformación de datos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parte_1/02_ejemplo_transformacion.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Limpieza y transformación de datos de COVID-19 en México</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parte_1/03_automatizacion_transformacion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Automatización</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parte_1/04_visualizacion_covid_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Curvas epidémicas</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../parte_2.html" class="sidebar-item-text sidebar-link">Geoinformática en R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parte_2/intro_R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introducción a R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#exploración-del-contenido" id="toc-exploración-del-contenido" class="nav-link active" data-scroll-target="#exploración-del-contenido"><span class="toc-section-number">2.1</span>  Exploración del contenido</a></li>
  <li><a href="#aplanado-de-datos" id="toc-aplanado-de-datos" class="nav-link" data-scroll-target="#aplanado-de-datos"><span class="toc-section-number">2.2</span>  Aplanado de datos</a></li>
  <li><a href="#manejo-de-fechas" id="toc-manejo-de-fechas" class="nav-link" data-scroll-target="#manejo-de-fechas"><span class="toc-section-number">2.3</span>  Manejo de fechas</a></li>
  <li><a href="#exportar-datos" id="toc-exportar-datos" class="nav-link" data-scroll-target="#exportar-datos"><span class="toc-section-number">2.4</span>  Exportar datos</a>
  <ul class="collapse">
  <li><a href="#tarea" id="toc-tarea" class="nav-link" data-scroll-target="#tarea"><span class="toc-section-number">2.4.1</span>  Tarea</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Limpieza y transformación de datos de COVID-19 en México</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>En el capítulo anterior hicimos una introducción a las herramientas básicas de Python para manipular datos. Ahora, en este capítulo, vamos a trabajar con una base de datos más compleja y trataremos de seguir un flujo de trabajo real, basado en experiencias de trabajo con equipos de apoyo a la toma de decisiones.</p>
<p>La base de datos que vamos a utilizar son los datos abiertos sobre COVID-19 que publica diarimente la Dirección General de Epidemiología de la Secretaría de Salud. Esta es una base muy grande y compleja que incluye el seguimiento de todos los casos confirmados de COVID en México. El tratamiento que vamos a dar a los datos, es el usado en diferentes flujos de trabajo de los grupos que estuvieron trabajando con la Secretaría de Salud para generar productos de análisis durante los primeros dos años de atención de la pandemia.</p>
<p>Antes de empezar a analizar la base de datos, vamos a importar las librerías que utilizaremos en el taller.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os <span class="co"># hablar con el sistema operativo</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob <span class="co"># listar directorios y ese tipo de operaciones</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools <span class="co"># herramientas para iterar objetos</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path <span class="co"># manipular rutas a directorios</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile <span class="co"># comprimir y descomprimir archivos</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># operaciones vectorizadas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># DataFrames</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta, date, datetime <span class="co"># Manejar fechas</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openpyxl <span class="co"># leer/escribir archivos de exel</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests <span class="co"># Hablar con direcciones web</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploración-del-contenido" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="exploración-del-contenido"><span class="header-section-number">2.1</span> Exploración del contenido</h2>
<p>Lo primero que vamos a hacer es explorar los datos publicados por la Secretaría de Salud para entender cómo están organizados. En la <a href="https://www.dropbox.com/sh/ikl1f698rjx9uag/AAD_7bcvipFk6pWQ2IvP1gsZa?dl=1">carpeta de datos del libro</a> puedes encontrar un ejemplo de la base de datos para el 9 de enero de 2023 bajo el nombre <code>datos_abiertos_covid19.zip</code>.</p>
<p>Para leer los datos vamos a utilizar la función <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">read_csv()</a>, esta función (como pueden ver) acepta que el csv venga comprimido en un zip.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'datos/datos_abiertos_covid19.zip'</span>, dtype<span class="op">=</span><span class="bu">object</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FECHA_ACTUALIZACION</th>
      <th>ID_REGISTRO</th>
      <th>ORIGEN</th>
      <th>SECTOR</th>
      <th>ENTIDAD_UM</th>
      <th>SEXO</th>
      <th>ENTIDAD_NAC</th>
      <th>ENTIDAD_RES</th>
      <th>MUNICIPIO_RES</th>
      <th>TIPO_PACIENTE</th>
      <th>...</th>
      <th>OTRO_CASO</th>
      <th>TOMA_MUESTRA_LAB</th>
      <th>RESULTADO_LAB</th>
      <th>TOMA_MUESTRA_ANTIGENO</th>
      <th>RESULTADO_ANTIGENO</th>
      <th>CLASIFICACION_FINAL</th>
      <th>MIGRANTE</th>
      <th>PAIS_NACIONALIDAD</th>
      <th>PAIS_ORIGEN</th>
      <th>UCI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-01-03</td>
      <td>01e27d</td>
      <td>2</td>
      <td>9</td>
      <td>25</td>
      <td>2</td>
      <td>25</td>
      <td>25</td>
      <td>001</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-01-03</td>
      <td>180725</td>
      <td>2</td>
      <td>9</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>012</td>
      <td>2</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-01-03</td>
      <td>06fce8</td>
      <td>1</td>
      <td>12</td>
      <td>07</td>
      <td>1</td>
      <td>07</td>
      <td>07</td>
      <td>059</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-01-03</td>
      <td>1a4a8d</td>
      <td>1</td>
      <td>12</td>
      <td>23</td>
      <td>2</td>
      <td>27</td>
      <td>23</td>
      <td>008</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-01-03</td>
      <td>1933c0</td>
      <td>1</td>
      <td>12</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>007</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div>
</div>
</div>
<p>Cada renglón en la base de datos corresponde a un caso en seguimiento, el resultado de cada caso se puede actualizar en sucesivas publicaciones de la base de datos. Las columnas describen un conjunto de variables asociadas al seguimiento de cada uno de los casos. Las dos primeras columnas corresponden a la fecha en la que se actualizó el caso y a un id único para cada caso respectivamente, en este taller no vamos a usar esas dos columnas.</p>
<p>Luego vienen un conjunto de columnas que describen la unidad médica de reporte y, después, las columnas que nos interesan más, que son las que describen al paciente.</p>
<p>Para entender un poco mejor los datos, conviene leer el archívo de catálogo. Lo pueden descargar del sitio de datos abiertos o bien usar el que viene en la carpeta de datos del libro bajo el nombre <code>201128 Catalogos.xlsx</code>. Como el catálogo es un archivo de excel con varias hojas, lo vamos a leer usando openpyxl que nos va a devolver un diccionario de DataFrames que relacionan el nombre de la hoja con los datos que contiene.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>catalogos <span class="op">=</span> <span class="st">'datos/201128 Catalogos.xlsx'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nombres_catalogos <span class="op">=</span> [<span class="st">'Catálogo de ENTIDADES'</span>, <span class="co"># Acá están los nombres de las hojas del excel</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Catálogo MUNICIPIOS'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Catálogo SI_NO'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Catálogo TIPO_PACIENTE'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Catálogo CLASIFICACION_FINAL'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Catálogo RESULTADO_LAB'</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                     ]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># read_excel nos regresa un diccionario que relaciona el nombre de cada hoja con </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># el contenido de la hoja como DataFrame</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>dict_catalogos <span class="op">=</span> pd.read_excel(catalogos,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                          nombres_catalogos,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                          dtype<span class="op">=</span><span class="bu">str</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                          engine<span class="op">=</span><span class="st">'openpyxl'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>clasificacion_final <span class="op">=</span> dict_catalogos[<span class="st">'Catálogo CLASIFICACION_FINAL'</span>]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Aquí le damos nombre a las columnas porque en el excel se saltan dos líneas</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>clasificacion_final.columns <span class="op">=</span> [<span class="st">"CLAVE"</span>, <span class="st">"CLASIFICACIÓN"</span>, <span class="st">"DESCRIPCIÓN"</span>] </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>clasificacion_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CLAVE</th>
      <th>CLASIFICACIÓN</th>
      <th>DESCRIPCIÓN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CLAVE</td>
      <td>CLASIFICACIÓN</td>
      <td>DESCRIPCIÓN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>CASO DE COVID-19 CONFIRMADO POR ASOCIACIÓN CLÍ...</td>
      <td>Confirmado por asociación aplica cuando el cas...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>CASO DE COVID-19 CONFIRMADO POR COMITÉ DE  DIC...</td>
      <td>Confirmado por dictaminación solo aplica para ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>CASO DE SARS-COV-2  CONFIRMADO</td>
      <td>Confirmado aplica cuando:\nEl caso tiene muest...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4</td>
      <td>INVÁLIDO POR LABORATORIO</td>
      <td>Inválido aplica cuando el caso no tienen asoci...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5</td>
      <td>NO REALIZADO POR LABORATORIO</td>
      <td>No realizado aplica cuando el caso no tienen a...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6</td>
      <td>CASO SOSPECHOSO</td>
      <td>Sospechoso aplica cuando: \nEl caso no tienen ...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>NEGATIVO A SARS-COV-2</td>
      <td>Negativo aplica cuando el caso:\n1. Se le tomo...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Lo que estamos viendo aquí es el catálogo de datos de la columna <code>CLASIFICACION_FINAL</code>. Este catálogo relaciona el valor de la <code>CLAVE</code> con su significado. En particular, la columna <code>CLASIFICACION_FINAL</code> es la que nos permite identificar los casos positivos como veremos más adelante.</p>
<p>El resto de los catálogos funciona de la misma forma, en este momento sólo vamos a utilizar la clasificación de los pacientes, pero más adelante podemos utilzar algunas de las columnas restantes.</p>
</section>
<section id="aplanado-de-datos" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="aplanado-de-datos"><span class="header-section-number">2.2</span> Aplanado de datos</h2>
<p>Como acabamos de ver, de alguna forma la información viene <em>distribuida</em> en tres archivos, uno con los datos, otro con las categorías que usa y un tercero con sus descripciones. Para utilizar los datos más fácilmente, sobre todo para poder hablarle a las cosas <em>por su nombre</em> en lugar de referirnos a sus valores codificados, vamos a realizar un conjunto de operaciones para <em>aplanar</em> los datos.</p>
<p>En el bajo mundo del análisis de datos, <em>aplanar</em> una base de datos es la operación de substituir los valores codificados a partir de un diccionario. En este caso, los datos que leímos traen valores codificados, entonces la primera misión es substituir esos valores por sus equivalentes en el diccionario.</p>
<p>Como la base de datos es muy grande, vamos a trabajar sólo con un estado de la república, en este caso la Ciudad de México (pero ustedes podrían elegir otro cualquiera).</p>
<p>Para seleccionar un estado, tenemos que <em>elegir</em> las filas del DataFrame que contengan el valor que queremos en la columna <em>ENTIDAD</em>, para eso vamos a aprender a usar nuestro primer operador de Pandas, el operador <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html">loc</a> que nos permite seleccionar filas a partir de los valores de una o más columnas.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># el copy() nos asegura tener una copia de los datos en lugar de una referencia, </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># con eso podemos liberar la memoria más fácil</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[df[<span class="st">'ENTIDAD_RES'</span>] <span class="op">==</span> <span class="st">'09'</span>].copy()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FECHA_ACTUALIZACION</th>
      <th>ID_REGISTRO</th>
      <th>ORIGEN</th>
      <th>SECTOR</th>
      <th>ENTIDAD_UM</th>
      <th>SEXO</th>
      <th>ENTIDAD_NAC</th>
      <th>ENTIDAD_RES</th>
      <th>MUNICIPIO_RES</th>
      <th>TIPO_PACIENTE</th>
      <th>...</th>
      <th>OTRO_CASO</th>
      <th>TOMA_MUESTRA_LAB</th>
      <th>RESULTADO_LAB</th>
      <th>TOMA_MUESTRA_ANTIGENO</th>
      <th>RESULTADO_ANTIGENO</th>
      <th>CLASIFICACION_FINAL</th>
      <th>MIGRANTE</th>
      <th>PAIS_NACIONALIDAD</th>
      <th>PAIS_ORIGEN</th>
      <th>UCI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2023-01-03</td>
      <td>180725</td>
      <td>2</td>
      <td>9</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>012</td>
      <td>2</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-01-03</td>
      <td>1933c0</td>
      <td>1</td>
      <td>12</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>007</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2023-01-03</td>
      <td>0741e4</td>
      <td>2</td>
      <td>6</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>016</td>
      <td>2</td>
      <td>...</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>97</td>
      <td>2</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2023-01-03</td>
      <td>1c4d2e</td>
      <td>2</td>
      <td>9</td>
      <td>09</td>
      <td>1</td>
      <td>09</td>
      <td>09</td>
      <td>012</td>
      <td>1</td>
      <td>...</td>
      <td>99</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2023-01-03</td>
      <td>0a6cd6</td>
      <td>2</td>
      <td>6</td>
      <td>09</td>
      <td>1</td>
      <td>18</td>
      <td>09</td>
      <td>007</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div>
</div>
</div>
<p>Fíjense que lo que hicimos fue reescribir en la variable <code>df</code> el resultado de nuestra selección, de forma que <code>df</code> ahora sólo contiene resultados para la CDMX.</p>
<p>Ahora ya con los datos filtrados y, por lo tanto, con un tamaño más manejable, vamos a empezar a trabajarlos. Lo primero que vamos a hacer es cambiar los valores de la columna <em>MUNICIPIO_RES</em> por la concatenación de las claves de estado y municipio, esto porque nos hará más adelante más fácil el trabajo de unir los datos con las geometrías de los municipios y porque además así tendremos un identificador único para estos (claro que esto sólo tiene sentido al trabajar con varios estados al mismo tiempo).</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MUNICIPIO_RES'</span>] <span class="op">=</span> df[<span class="st">'ENTIDAD_RES'</span>] <span class="op">+</span> df[<span class="st">'MUNICIPIO_RES'</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FECHA_ACTUALIZACION</th>
      <th>ID_REGISTRO</th>
      <th>ORIGEN</th>
      <th>SECTOR</th>
      <th>ENTIDAD_UM</th>
      <th>SEXO</th>
      <th>ENTIDAD_NAC</th>
      <th>ENTIDAD_RES</th>
      <th>MUNICIPIO_RES</th>
      <th>TIPO_PACIENTE</th>
      <th>...</th>
      <th>OTRO_CASO</th>
      <th>TOMA_MUESTRA_LAB</th>
      <th>RESULTADO_LAB</th>
      <th>TOMA_MUESTRA_ANTIGENO</th>
      <th>RESULTADO_ANTIGENO</th>
      <th>CLASIFICACION_FINAL</th>
      <th>MIGRANTE</th>
      <th>PAIS_NACIONALIDAD</th>
      <th>PAIS_ORIGEN</th>
      <th>UCI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2023-01-03</td>
      <td>180725</td>
      <td>2</td>
      <td>9</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>09012</td>
      <td>2</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-01-03</td>
      <td>1933c0</td>
      <td>1</td>
      <td>12</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>09007</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2023-01-03</td>
      <td>0741e4</td>
      <td>2</td>
      <td>6</td>
      <td>09</td>
      <td>2</td>
      <td>09</td>
      <td>09</td>
      <td>09016</td>
      <td>2</td>
      <td>...</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>97</td>
      <td>2</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2023-01-03</td>
      <td>1c4d2e</td>
      <td>2</td>
      <td>9</td>
      <td>09</td>
      <td>1</td>
      <td>09</td>
      <td>09</td>
      <td>09012</td>
      <td>1</td>
      <td>...</td>
      <td>99</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2023-01-03</td>
      <td>0a6cd6</td>
      <td>2</td>
      <td>6</td>
      <td>09</td>
      <td>1</td>
      <td>18</td>
      <td>09</td>
      <td>09007</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>97</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>99</td>
      <td>MÃ©xico</td>
      <td>97</td>
      <td>97</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div>
</div>
</div>
<p>Ahora vamos a corregir el nombre de una columna en la base de datos para que coincida con el nombre en el diccionario y después podamos buscar automáticamente. Pra corregir el nombre de la columna vamos a utilizar la función <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html">rename</a> de Pandas. Esta función nos sirve para renombrar filas (el índice del DataFrame, que vamos a ver más adelante) o columnas dependiendo de qué eje seleccionemos. El eje 0 son las filas y el 1 las columnas.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Como estamos usando explícitamente el parámetro columns, </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># no necesitamos especificar el eje</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'OTRA_COM'</span>: <span class="st">'OTRAS_COM'</span>})</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index(['FECHA_ACTUALIZACION', 'ID_REGISTRO', 'ORIGEN', 'SECTOR', 'ENTIDAD_UM',
       'SEXO', 'ENTIDAD_NAC', 'ENTIDAD_RES', 'MUNICIPIO_RES', 'TIPO_PACIENTE',
       'FECHA_INGRESO', 'FECHA_SINTOMAS', 'FECHA_DEF', 'INTUBADO', 'NEUMONIA',
       'EDAD', 'NACIONALIDAD', 'EMBARAZO', 'HABLA_LENGUA_INDIG', 'INDIGENA',
       'DIABETES', 'EPOC', 'ASMA', 'INMUSUPR', 'HIPERTENSION', 'OTRAS_COM',
       'CARDIOVASCULAR', 'OBESIDAD', 'RENAL_CRONICA', 'TABAQUISMO',
       'OTRO_CASO', 'TOMA_MUESTRA_LAB', 'RESULTADO_LAB',
       'TOMA_MUESTRA_ANTIGENO', 'RESULTADO_ANTIGENO', 'CLASIFICACION_FINAL',
       'MIGRANTE', 'PAIS_NACIONALIDAD', 'PAIS_ORIGEN', 'UCI'],
      dtype='object')</code></pre>
</div>
</div>
<p>Fíjense cómo otra vez reescribimos la variable <code>df</code>. La mayor parte de las operaciones en Pandas regresan un DataFrame con el resultado de la operación y no modifican el DataFrame original, entonces para <em>guardar</em> los resultados, necesitamos reescribir la variable (o guardarla con otro nombre)</p>
<p>Ahora sí podemos empezar a <em>aplanar</em> los datos. Vamos a empezar por resolver las claves de resultado de las pruebas COVID. En los datos originales estos vienen codificados en la columna <strong>RESULTADO_LAB</strong>, pero en el diccionario ese velor se llama <strong>RESULTADO</strong>, entonces otra vez vamos a empezar por renombrar una columna.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'RESULTADO_LAB'</span>: <span class="st">'RESULTADO'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para sustituir los valores en nuestros datos originales vamos a usar la función <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.map.html">map</a> que toma una serie (una serie es una columna de un dataframe) y <em>mapea</em> sus valores de acuerdo a una correspondencia que podemos pasar como un diccionario. Veamos poco a poco cómo hacer lo que queremos.</p>
<p>Lo primero que necesitamos es un diccionario que relacione los valores en nuestros datos con los nombres en el diccionario. Recordemos cómo se ve el diccionario:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>clasificacion_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CLAVE</th>
      <th>CLASIFICACIÓN</th>
      <th>DESCRIPCIÓN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CLAVE</td>
      <td>CLASIFICACIÓN</td>
      <td>DESCRIPCIÓN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>CASO DE COVID-19 CONFIRMADO POR ASOCIACIÓN CLÍ...</td>
      <td>Confirmado por asociación aplica cuando el cas...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>CASO DE COVID-19 CONFIRMADO POR COMITÉ DE  DIC...</td>
      <td>Confirmado por dictaminación solo aplica para ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>CASO DE SARS-COV-2  CONFIRMADO</td>
      <td>Confirmado aplica cuando:\nEl caso tiene muest...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4</td>
      <td>INVÁLIDO POR LABORATORIO</td>
      <td>Inválido aplica cuando el caso no tienen asoci...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5</td>
      <td>NO REALIZADO POR LABORATORIO</td>
      <td>No realizado aplica cuando el caso no tienen a...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6</td>
      <td>CASO SOSPECHOSO</td>
      <td>Sospechoso aplica cuando: \nEl caso no tienen ...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>NEGATIVO A SARS-COV-2</td>
      <td>Negativo aplica cuando el caso:\n1. Se le tomo...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Necesitamos un diccionario <code>{CLASIFICACION:CLAVE}</code> (ya sé que hay unos valores espurios, pero no nos importan porque simplemente esos no los va a encontrar en nuestra base de datos).</p>
<p>Para construir este diccionario, vamos a empezar por construir la <em>tupla</em> que mantiene la relación que buscamos, para eso vamos a utilizar la función <a href="https://www.w3schools.com/python/ref_fu">zip</a> que toma dos <em>iteradores</em> como entrada y regresa un <em>iterador</em> que tiene por elementos las tuplas hechas elemento a elemento entre los dos iteradores de inicio. Veamoslo con calma:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>l1 <span class="op">=</span> [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>l3 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(l1,l2))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>l3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>[('a', 1), ('b', 2), ('c', 3)]</code></pre>
</div>
</div>
<p>Lo que nos regresa <code>zip</code> es un iterado con las tuplas formadas por los pares ordenados de los iteradores de entrada. En Python un iterador es cualquier cosa que se pueda <em>recorrer en orden</em>, a veces estos iteradores, como en el caso de <code>zip</code> no regresan todas las entradas sino, para ahorrar memoria, las generan conforme se recorren, por eso hay que hacer <code>list(zip)</code> para que se generen las entradas.</p>
<p>Ahora sí podemos entonces crear el diccionario con el que vamos a actualizar los datos:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>clasificacion_final <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(clasificacion_final[<span class="st">'CLAVE'</span>], clasificacion_final[<span class="st">'CLASIFICACIÓN'</span>]))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>clasificacion_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{nan: nan,
 'CLAVE': 'CLASIFICACIÓN',
 '1': 'CASO DE COVID-19 CONFIRMADO POR ASOCIACIÓN CLÍNICA EPIDEMIOLÓGICA',
 '2': 'CASO DE COVID-19 CONFIRMADO POR COMITÉ DE  DICTAMINACIÓN',
 '3': 'CASO DE SARS-COV-2  CONFIRMADO',
 '4': 'INVÁLIDO POR LABORATORIO',
 '5': 'NO REALIZADO POR LABORATORIO',
 '6': 'CASO SOSPECHOSO',
 '7': 'NEGATIVO A SARS-COV-2'}</code></pre>
</div>
</div>
<p>Y entonces pasarlo como argumento a la función <code>map</code>. Hay un truco aquí, <code>map</code> toma como argumento una función que, para cada llave, regresa el valor correspondiente, entonces no es propiamente el diccionario lo que vamos a pasar, sino la función <a href="https://www.w3schools.com/python/ref_dictionary_get.asp">get</a> del diccionario que hace justo lo que queremos. Esto nos revela una prpiedad curiosa de Python, los argumentos de una función pueden ser funciones.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CLASIFICACION_FINAL'</span>] <span class="op">=</span> df[<span class="st">'CLASIFICACION_FINAL'</span>].<span class="bu">map</span>(clasificacion_final.get)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CLASIFICACION_FINAL'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>1                                 NEGATIVO A SARS-COV-2
4                                 NEGATIVO A SARS-COV-2
8     CASO DE COVID-19 CONFIRMADO POR COMITÉ DE  DIC...
13                       CASO DE SARS-COV-2  CONFIRMADO
15                                NEGATIVO A SARS-COV-2
Name: CLASIFICACION_FINAL, dtype: object</code></pre>
</div>
</div>
<p>Ahora vamos a hacer una sustitución un poco más compleja, tenemos que encontrar todos los campos de tipo “SI - NO” y resolverlos (sustituir por valores que podamos manejar más fácil). Los campos que tienen este tipo de datos vienen en el excel de descriptores:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>descriptores <span class="op">=</span> pd.read_excel(<span class="st">'datos/201128 Descriptores_.xlsx'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                             index_col<span class="op">=</span><span class="st">'Nº'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                             engine<span class="op">=</span><span class="st">'openpyxl'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>descriptores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>NOMBRE DE VARIABLE</th>
      <th>DESCRIPCIÓN DE VARIABLE</th>
      <th>FORMATO O FUENTE</th>
    </tr>
    <tr>
      <th>Nº</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>FECHA_ACTUALIZACION</td>
      <td>La base de datos se alimenta diariamente, esta...</td>
      <td>AAAA-MM-DD</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_REGISTRO</td>
      <td>Número identificador del caso</td>
      <td>TEXTO</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ORIGEN</td>
      <td>La vigilancia centinela se realiza a través de...</td>
      <td>CATÁLOGO: ORIGEN                              ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SECTOR</td>
      <td>Identifica el tipo de institución del Sistema ...</td>
      <td>CATÁLOGO: SECTOR                              ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ENTIDAD_UM</td>
      <td>Identifica la entidad donde se ubica la unidad...</td>
      <td>CATALÓGO: ENTIDADES</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SEXO</td>
      <td>Identifica al sexo del paciente.</td>
      <td>CATÁLOGO: SEXO</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ENTIDAD_NAC</td>
      <td>Identifica la entidad de nacimiento del paciente.</td>
      <td>CATALÓGO: ENTIDADES</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ENTIDAD_RES</td>
      <td>Identifica la entidad de residencia del paciente.</td>
      <td>CATALÓGO: ENTIDADES</td>
    </tr>
    <tr>
      <th>9</th>
      <td>MUNICIPIO_RES</td>
      <td>Identifica el municipio de residencia del paci...</td>
      <td>CATALÓGO: MUNICIPIOS</td>
    </tr>
    <tr>
      <th>10</th>
      <td>TIPO_PACIENTE</td>
      <td>Identifica el tipo de atención que recibió el ...</td>
      <td>CATÁLOGO: TIPO_PACIENTE</td>
    </tr>
    <tr>
      <th>11</th>
      <td>FECHA_INGRESO</td>
      <td>Identifica la fecha de ingreso del paciente a ...</td>
      <td>AAAA-MM-DD</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FECHA_SINTOMAS</td>
      <td>Idenitifica la fecha en que inició la sintomat...</td>
      <td>AAAA-MM-DD</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FECHA_DEF</td>
      <td>Identifica la fecha en que el paciente falleció.</td>
      <td>AAAA-MM-DD</td>
    </tr>
    <tr>
      <th>14</th>
      <td>INTUBADO</td>
      <td>Identifica si el paciente requirió de intubación.</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>NEUMONIA</td>
      <td>Identifica si al paciente se le diagnosticó co...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>EDAD</td>
      <td>Identifica la edad del paciente.</td>
      <td>NÚMERICA EN AÑOS</td>
    </tr>
    <tr>
      <th>17</th>
      <td>NACIONALIDAD</td>
      <td>Identifica si el paciente es mexicano o extran...</td>
      <td>CATÁLOGO: NACIONALIDAD</td>
    </tr>
    <tr>
      <th>18</th>
      <td>EMBARAZO</td>
      <td>Identifica si la paciente está embarazada.</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>HABLA_LENGUA_INDIG</td>
      <td>Identifica si el paciente habla lengua índigena.</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>20</th>
      <td>INDIGENA</td>
      <td>Identifica si el paciente se autoidentifica co...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>21</th>
      <td>DIABETES</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>22</th>
      <td>EPOC</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ASMA</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>24</th>
      <td>INMUSUPR</td>
      <td>Identifica si el paciente presenta inmunosupre...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>25</th>
      <td>HIPERTENSION</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>26</th>
      <td>OTRAS_COM</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>27</th>
      <td>CARDIOVASCULAR</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>28</th>
      <td>OBESIDAD</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>29</th>
      <td>RENAL_CRONICA</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>30</th>
      <td>TABAQUISMO</td>
      <td>Identifica si el paciente tiene hábito de taba...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>31</th>
      <td>OTRO_CASO</td>
      <td>Identifica si el paciente tuvo contacto con al...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>32</th>
      <td>TOMA_MUESTRA_LAB</td>
      <td>Identifica si al paciente se le tomó muestra d...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>33</th>
      <td>RESULTADO_LAB</td>
      <td>Identifica el resultado del análisis de la mue...</td>
      <td>CATÁLOGO: RESULTADO_LAB</td>
    </tr>
    <tr>
      <th>34</th>
      <td>TOMA_MUESTRA_ANTIGENO</td>
      <td>Identifica si al paciente se le tomó muestra d...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>35</th>
      <td>RESULTADO_ANTIGENO</td>
      <td>Identifica el resultado del análisis de la mue...</td>
      <td>CATÁLOGO: RESULTADO_ANTIGENO</td>
    </tr>
    <tr>
      <th>36</th>
      <td>CLASIFICACION_FINAL</td>
      <td>Identifica si el paciente es un caso de COVID-...</td>
      <td>CATÁLOGO: CLASIFICACION_FINAL</td>
    </tr>
    <tr>
      <th>37</th>
      <td>MIGRANTE</td>
      <td>Identifica si el paciente es una persona migra...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
    <tr>
      <th>38</th>
      <td>PAIS_NACIONALIDAD</td>
      <td>Identifica la nacionalidad del paciente.</td>
      <td>TEXTO, 99= SE IGNORA</td>
    </tr>
    <tr>
      <th>39</th>
      <td>PAIS_ORIGEN</td>
      <td>Identifica el país del que partió el paciente ...</td>
      <td>TEXTO, 97= NO APLICA</td>
    </tr>
    <tr>
      <th>40</th>
      <td>UCI</td>
      <td>Identifica si el paciente requirió ingresar a ...</td>
      <td>CATÁLOGO: SI_ NO                              ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Fíjense en alguno de estos campos en los datos:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'OBESIDAD'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array(['2', '98', '1'], dtype=object)</code></pre>
</div>
</div>
<p>Tenemos tres valores diferentes que corresponden (vean el diccionario) a SI, NO y NO ESPECIFICADO. Para todos los análisis que vamos a hacer en general sólo nos van a interesar los casos que <strong>sabemos</strong> que son SI, entonces lo que más nos conviene es codificar todos estos como binarios, es decir, sólo SI o NO. Además, podemos mejor decirles 1,0 respectivamente y así vamos a poder hacer cuentas mucho más fácil</p>
<p>De estos descriptores nos interesan los que tienen <code>CATÁLOGO: SI_ NO</code> en el campo <code>FORMATO O FUENTE</code>. Para poder encontrar y sustituir de forma más sencilla y automática vamos a hacer un par de modificaciones a los datos:</p>
<ul>
<li>Reemplazar los espacios en los nombres de columnas por guiones bajos (para poder “hablarles” más fácil a las columnas)</li>
<li>Quitar espacios al principio o al final de los valores de los campos (para asegurarnos de que siempre van a ser los mismos)</li>
</ul>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>descriptores.columns <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> col: col.replace(<span class="st">' '</span>, <span class="st">'_'</span>), descriptores.columns))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>descriptores.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>NOMBRE_DE_VARIABLE</th>
      <th>DESCRIPCIÓN_DE_VARIABLE</th>
      <th>FORMATO_O_FUENTE</th>
    </tr>
    <tr>
      <th>Nº</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>FECHA_ACTUALIZACION</td>
      <td>La base de datos se alimenta diariamente, esta...</td>
      <td>AAAA-MM-DD</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_REGISTRO</td>
      <td>Número identificador del caso</td>
      <td>TEXTO</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ORIGEN</td>
      <td>La vigilancia centinela se realiza a través de...</td>
      <td>CATÁLOGO: ORIGEN                              ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SECTOR</td>
      <td>Identifica el tipo de institución del Sistema ...</td>
      <td>CATÁLOGO: SECTOR                              ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ENTIDAD_UM</td>
      <td>Identifica la entidad donde se ubica la unidad...</td>
      <td>CATALÓGO: ENTIDADES</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Poco a poco:</p>
<ul>
<li><code>descriptores.columns</code> nos regresa (o les da valor, cuando está del lado izquierdo de un <code>=</code>) los nombres de las columnas del DataFrame</li>
<li><code>map(lambda col: col.replace(' ', '_'), descriptores.columns)</code> la función <code>map</code> regresa una asosiación, como ya vimos. En este caso esta asosiación se hace a través de una <em>función anónima</em> <a href="https://www.w3schools.com/python/python_lambda.asp">lambda</a> que toma como argumento el nombre de una columna y regresa el mismo nombre pero con los espacios sustituidos por guines bajos</li>
</ul>
<p>Al final, lo que hacemos es sustituir los nombres de las columnas por una lista hecha por nosotros, para que esto funcione la lista que pasamos debe ser de igual tamaño que la lista original de columnas.</p>
<p>Ahora vamos a hacer lo mismo pero con los valores de los campos:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>descriptores[<span class="st">'FORMATO_O_FUENTE'</span>] <span class="op">=</span> descriptores.FORMATO_O_FUENTE.<span class="bu">str</span>.strip()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>descriptores[<span class="st">'FORMATO_O_FUENTE'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Nº
1             AAAA-MM-DD
2                  TEXTO
3       CATÁLOGO: ORIGEN
4       CATÁLOGO: SECTOR
5    CATALÓGO: ENTIDADES
Name: FORMATO_O_FUENTE, dtype: object</code></pre>
</div>
</div>
<p>Este fué más fácil. Fíjense cómo pedimos el campo del lado derecho: <code>descriptores.FORMATO_O_FUENTE</code>, esto es equivalente a <code>descriptores['FORMATO_O_FUENTE']</code> y los pueden usar indistintamente (claro, el primero sólo funciona si el nombre del campo no tiene espacios).</p>
<p>Filtremos ahora los descriptores para quedarnos sólo con los que nos interesan, para eso vamos a usar la función <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.query.html">query</a> de Pandas, que nos permite filtrar un DataFrame de forma conveniente usando una expresión <em>booleana</em>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>datos_si_no <span class="op">=</span> descriptores.query(<span class="st">'FORMATO_O_FUENTE == "CATÁLOGO: SI_ NO"'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>datos_si_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>NOMBRE_DE_VARIABLE</th>
      <th>DESCRIPCIÓN_DE_VARIABLE</th>
      <th>FORMATO_O_FUENTE</th>
    </tr>
    <tr>
      <th>Nº</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>INTUBADO</td>
      <td>Identifica si el paciente requirió de intubación.</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>15</th>
      <td>NEUMONIA</td>
      <td>Identifica si al paciente se le diagnosticó co...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>18</th>
      <td>EMBARAZO</td>
      <td>Identifica si la paciente está embarazada.</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>19</th>
      <td>HABLA_LENGUA_INDIG</td>
      <td>Identifica si el paciente habla lengua índigena.</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>20</th>
      <td>INDIGENA</td>
      <td>Identifica si el paciente se autoidentifica co...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>21</th>
      <td>DIABETES</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>22</th>
      <td>EPOC</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ASMA</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>24</th>
      <td>INMUSUPR</td>
      <td>Identifica si el paciente presenta inmunosupre...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>25</th>
      <td>HIPERTENSION</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>26</th>
      <td>OTRAS_COM</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>27</th>
      <td>CARDIOVASCULAR</td>
      <td>Identifica si el paciente tiene un diagnóstico...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>28</th>
      <td>OBESIDAD</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>29</th>
      <td>RENAL_CRONICA</td>
      <td>Identifica si el paciente tiene diagnóstico de...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>30</th>
      <td>TABAQUISMO</td>
      <td>Identifica si el paciente tiene hábito de taba...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>31</th>
      <td>OTRO_CASO</td>
      <td>Identifica si el paciente tuvo contacto con al...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>32</th>
      <td>TOMA_MUESTRA_LAB</td>
      <td>Identifica si al paciente se le tomó muestra d...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>34</th>
      <td>TOMA_MUESTRA_ANTIGENO</td>
      <td>Identifica si al paciente se le tomó muestra d...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>37</th>
      <td>MIGRANTE</td>
      <td>Identifica si el paciente es una persona migra...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
    <tr>
      <th>40</th>
      <td>UCI</td>
      <td>Identifica si el paciente requirió ingresar a ...</td>
      <td>CATÁLOGO: SI_ NO</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Por si acaso, quitémosle también los espacios al campo <code>FORMATO_O_FUENTE</code></p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>descriptores[<span class="st">'FORMATO_O_FUENTE'</span>] <span class="op">=</span> descriptores.FORMATO_O_FUENTE.<span class="bu">str</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora sí, vamos a sustituir los valores como queremos en los datos originales. Para eso, lo primero que tenemos que hacer es fijarnos en el catálogo de estos campos:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cat_si_no <span class="op">=</span> dict_catalogos[<span class="st">'Catálogo SI_NO'</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cat_si_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CLAVE</th>
      <th>DESCRIPCIÓN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>SI</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NO</td>
    </tr>
    <tr>
      <th>2</th>
      <td>97</td>
      <td>NO APLICA</td>
    </tr>
    <tr>
      <th>3</th>
      <td>98</td>
      <td>SE IGNORA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>99</td>
      <td>NO ESPECIFICADO</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Justo estos valores los queremos cambiar por claves binarias (acuérdense, para distinguirlos fácilmente). Entonces lo que necesitamos ahora es:</p>
<ul>
<li>Una lista de los nombres de los campos en donde vamos a hacer la sustitución</li>
<li>Un mapeo de los valores con los que vamos a sustituir</li>
<li>Hacer la sustitución primero en el diccionario y a partir de eso en los datos originales</li>
</ul>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lista de los nombres de los campos</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>campos_si_no <span class="op">=</span> datos_si_no.NOMBRE_DE_VARIABLE</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sustituimos en el catálogo de acuerdo a lo que nos interesa</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>cat_si_no[<span class="st">'DESCRIPCIÓN'</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> val: <span class="dv">1</span> <span class="cf">if</span> val <span class="op">==</span> <span class="st">'SI'</span> <span class="cf">else</span> <span class="dv">0</span>, cat_si_no[<span class="st">'DESCRIPCIÓN'</span>]))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sustituimos en los datos originales</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df[campos_si_no] <span class="op">=</span> df[datos_si_no.NOMBRE_DE_VARIABLE].replace(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                            to_replace<span class="op">=</span>cat_si_no[<span class="st">'CLAVE'</span>].values,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                            value<span class="op">=</span>cat_si_no[<span class="st">'DESCRIPCIÓN'</span>].values)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>df[campos_si_no]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>INTUBADO</th>
      <th>NEUMONIA</th>
      <th>EMBARAZO</th>
      <th>HABLA_LENGUA_INDIG</th>
      <th>INDIGENA</th>
      <th>DIABETES</th>
      <th>EPOC</th>
      <th>ASMA</th>
      <th>INMUSUPR</th>
      <th>HIPERTENSION</th>
      <th>OTRAS_COM</th>
      <th>CARDIOVASCULAR</th>
      <th>OBESIDAD</th>
      <th>RENAL_CRONICA</th>
      <th>TABAQUISMO</th>
      <th>OTRO_CASO</th>
      <th>TOMA_MUESTRA_LAB</th>
      <th>TOMA_MUESTRA_ANTIGENO</th>
      <th>MIGRANTE</th>
      <th>UCI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6393642</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6394417</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6394626</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6394988</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6395781</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>1896084 rows × 20 columns</p>
</div>
</div>
</div>
<p>Acá utilizamos para la última sustitución la función <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.replace.html">replace</a> de Pandas que toma dos parámetros: la lista de valores a reemplazar y la lista de los valoresa de reemplazo. El reemplazo sucede elemento a elemento, es decir, se sustituye el primer elemento de la lista <code>to_replace</code> por el primer elemento de la lista <code>value</code> y así sucesivamente.</p>
<p>Hay más campos que podemos <em>aplanar</em> en la base de datos, como ejercicio pueden explorar algunos de ellos y sustituir como le hemos hecho aquí. Regresaremos a esto más adelante en el taller, pero por lo pronto nos vamos a mover a otra etapa del pre-procesamiento: el manejo de las fechas</p>
</section>
<section id="manejo-de-fechas" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="manejo-de-fechas"><span class="header-section-number">2.3</span> Manejo de fechas</h2>
<p>En Python las fechas son un tipo especial de datos, nosotros estamos acostumbrados a verlas como cadenas de caractéres: 20 de febrero de 2010, por ejemplo. Python puede hacer muchas cosas con las fechas, pero para eso tienen que estar codificados de la forma correcta.</p>
<p>En general el módulo <a href="https://docs.python.org/3/library/datetime.html"><code>datetime</code></a> de Python provee las utilerías necesarias para manejar/transformar objetos del tipo fecha. Una de las cosas más útiles es transformar strings en objetos <code>datetime</code>:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>datetime_object <span class="op">=</span> datetime.strptime(<span class="st">'Jun 1 2005  1:33PM'</span>, <span class="st">'%b </span><span class="sc">%d</span><span class="st"> %Y %I:%M%p'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>datetime_object</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>datetime.datetime(2005, 6, 1, 13, 33)</code></pre>
</div>
</div>
<p>Acá usamos un formato de fecha, <code>'%b %d %Y %I:%M%p'</code>, para convertir el string <code>'Jun 1 2005  1:33PM'</code>. De esa misma forma podemos especificar formatos diferentes:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>datetime_object <span class="op">=</span> datetime.strptime(<span class="st">'06-01-2005  1:33PM'</span>, <span class="st">'%m-</span><span class="sc">%d</span><span class="st">-%Y %I:%M%p'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>datetime_object</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>datetime.datetime(2005, 6, 1, 13, 33)</code></pre>
</div>
</div>
<p>Pandas tiene la <em>interfase</em> <a href="https://pandas.pydata.org/docs/reference/api/pandas.to_datetime.html">to_datetime</a> para este tipo de operaciones que nos permite transformar campos de forma muy sencilla, por ejemplo, para transformar la columna <code>FECHA_INGRESO</code> de los datos originales en objetos de tipo datetime podemos hacer:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pd.to_datetime(df[<span class="st">'FECHA_INGRESO'</span>].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>1    2022-01-19
4    2022-03-09
8    2022-02-20
13   2022-01-01
15   2022-06-28
Name: FECHA_INGRESO, dtype: datetime64[ns]</code></pre>
</div>
</div>
<p>Vean la diferencia con el tipo de datos original:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'FECHA_INGRESO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>1     2022-01-19
4     2022-03-09
8     2022-02-20
13    2022-01-01
15    2022-06-28
Name: FECHA_INGRESO, dtype: object</code></pre>
</div>
</div>
<p>Esto va a funcionar perfecto cuando el campo tiene sólo datos válidos (todos se ajustan a algún formato de fecha), pero ¿qué pasa en campos en donde no todos los datos son fechas válidas?</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pd.to_datetime(df[<span class="st">'FECHA_DEF'</span>].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ParserError: month must be in 1..12: 9999-99-99 present at position 0</code></pre>
</div>
</div>
<p>ERROR!!!!! Efectívamente, pandas no puede transformar algunos datos en fechas verdaderas (porque no todos los registros tienen una fecha de defunción válida). Entonces hay que decirle a Pandas qué hacer con estos registros, lo que queremos en este caso es que los registros inválidos los regrese como nulos, para eso usamos la opción <code>coerce</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pd.to_datetime(df[<span class="st">'FECHA_DEF'</span>].head(), <span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>1           NaT
4           NaT
8    2022-02-21
13          NaT
15          NaT
Name: FECHA_DEF, dtype: datetime64[ns]</code></pre>
</div>
</div>
<p>Listo, los registros que no se pueden convertir en fechas ahopra regresan <code>NaT</code> (Not a Time) en lugar de error.</p>
<p>Con esto en realidad ya es muy simple convertir toda una columna en tipo fecha:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'FECHA_INGRESO'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'FECHA_INGRESO'</span>])</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'FECHA_INGRESO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>1    2022-01-19
4    2022-03-09
8    2022-02-20
13   2022-01-01
15   2022-06-28
Name: FECHA_INGRESO, dtype: datetime64[ns]</code></pre>
</div>
</div>
</section>
<section id="exportar-datos" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="exportar-datos"><span class="header-section-number">2.4</span> Exportar datos</h2>
<p>Ya que tenemos procesados los datos, es muy posible que los querramos guardar para usarlos más adelante. La forma más sencilla de exportar los datos es guardarlos como un csv. Para esto Pandas tiene el método <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_csv.html"><code>to_csv</code></a></p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"datos/covid_enero_2023_procesados.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hasta aquí hemos cubierto más o menos todo el pre-proceso de los datos. Claro no vimos todas las columnas, sólo nos fijamos en algunas, pero eso basta para darnos una buena idea de cómo se hacen las demás.</p>
<section id="tarea" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="tarea"><span class="header-section-number">2.4.1</span> Tarea</h3>
<p>Sustituyan los valores de la columna <code>TIPO_PACIENTE</code> por sus valores en el catálogo correspondiente</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../parte_1/01_transformacion.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Transformación de datos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../parte_1/03_automatizacion_transformacion.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Automatización</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>